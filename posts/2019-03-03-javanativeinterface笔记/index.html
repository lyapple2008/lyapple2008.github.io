<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>JavaNativeInterface笔记 | BeYoung</title><meta name=keywords content="Android,JNI"><meta name=description content="最近由于公司项目的原因开始接触WebRTC，其中Android相关部分由于需要跨越了两种不同的语
言，因此需要一种机制能够让C/C++和JAVA之间进行交互，而JNI就是这样一种机制。通过JNI可
以实现C/C++和JAVA之前需要交互。本篇笔记的首先从一个实际的例子开始介绍JNI操作的完整流
程是怎样的；接着将就这个例子完整介绍JNI中需要注意的点。

"><meta name=author content="Marshall Liu"><link rel=canonical href=https://lyapple2008.github.io/posts/2019-03-03-javanativeinterface%E7%AC%94%E8%AE%B0/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://lyapple2008.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lyapple2008.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lyapple2008.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lyapple2008.github.io/apple-touch-icon.png><link rel=mask-icon href=https://lyapple2008.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://lyapple2008.github.io/posts/2019-03-03-javanativeinterface%E7%AC%94%E8%AE%B0/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://lyapple2008.github.io/posts/2019-03-03-javanativeinterface%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="BeYoung"><meta property="og:title" content="JavaNativeInterface笔记"><meta property="og:description" content="最近由于公司项目的原因开始接触WebRTC，其中Android相关部分由于需要跨越了两种不同的语 言，因此需要一种机制能够让C/C++和JAVA之间进行交互，而JNI就是这样一种机制。通过JNI可 以实现C/C++和JAVA之前需要交互。本篇笔记的首先从一个实际的例子开始介绍JNI操作的完整流 程是怎样的；接着将就这个例子完整介绍JNI中需要注意的点。 "><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-03-03T22:51:59+00:00"><meta property="article:modified_time" content="2019-03-03T22:51:59+00:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="JNI"><meta property="og:image" content="https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="JavaNativeInterface笔记"><meta name=twitter:description content="最近由于公司项目的原因开始接触WebRTC，其中Android相关部分由于需要跨越了两种不同的语
言，因此需要一种机制能够让C/C++和JAVA之间进行交互，而JNI就是这样一种机制。通过JNI可
以实现C/C++和JAVA之前需要交互。本篇笔记的首先从一个实际的例子开始介绍JNI操作的完整流
程是怎样的；接着将就这个例子完整介绍JNI中需要注意的点。

"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lyapple2008.github.io/posts/"},{"@type":"ListItem","position":2,"name":"JavaNativeInterface笔记","item":"https://lyapple2008.github.io/posts/2019-03-03-javanativeinterface%E7%AC%94%E8%AE%B0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"JavaNativeInterface笔记","name":"JavaNativeInterface笔记","description":"最近由于公司项目的原因开始接触WebRTC，其中Android相关部分由于需要跨越了两种不同的语 言，因此需要一种机制能够让C/C++和JAVA之间进行交互，而JNI就是这样一种机制。通过JNI可 以实现C/C++和JAVA之前需要交互。本篇笔记的首先从一个实际的例子开始介绍JNI操作的完整流 程是怎样的；接着将就这个例子完整介绍JNI中需要注意的点。 ","keywords":["Android","JNI"],"articleBody":"最近由于公司项目的原因开始接触WebRTC，其中Android相关部分由于需要跨越了两种不同的语 言，因此需要一种机制能够让C/C++和JAVA之间进行交互，而JNI就是这样一种机制。通过JNI可 以实现C/C++和JAVA之前需要交互。本篇笔记的首先从一个实际的例子开始介绍JNI操作的完整流 程是怎样的；接着将就这个例子完整介绍JNI中需要注意的点。 JNI操作完整流程介绍 编写Java类及声明Native方法 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 public class Java2C { static { System.loadLibrary(\"jni\"); } // 成员变量 private int number = 88; private static double speed = 55.66; private String message = \"Hello from Java.\"; // 基本数据类型 private native double average(int n1, int n2); // 引用类型 private native String sayHello(String msg); // 基本数据类型数组 private native double[] sumAndAverage(int[] numbers); // 引用类型数组 private native String[] num2Str(int[] numbers); // 操作java成员变量 private native void modifyJavaVariable(); // java成员方法 private void callback(String message) { System.out.println(\"In Java with \" + message); } private double callbackAverage(int n1, int n2) { return ((double)n1 + n2) / 2.0; } // 静态成员方法 private static String callbackStatic() { return \"From static Java method.\"; } private native void testCallbackMethod(); public static void main(String[] args) { Java2C javaClass = new Java2C(); double aver = javaClass.average(5, 6); System.out.println(\"primitive type: the average of 5 and 6 is \" + aver); System.out.println(\"Reference type: \"); String javaString = javaClass.sayHello(\"Hello From Java\"); System.out.println(javaString); System.out.println(\"primitive type array: \"); int[] numbers = {11, 22, 33}; double[] results = javaClass.sumAndAverage(numbers); System.out.println(\"In Java, the sum is \" + results[0]); System.out.println(\"In Java, the average is \" + results[1]); System.out.println(\"reference type array: \"); String[] numStrs = javaClass.num2Str(numbers); System.out.println(\"In Java the string is \" + numStrs[0] + \" \" + numStrs[1] + \" \" + numStrs[2]); System.out.println(\"Operate java variable: \"); javaClass.modifyJavaVariable(); System.out.println(\"C/C++　call java viarable and method\"); javaClass.testCallbackMethod(); } } 生成jni native头文件 javac -h \u003c头文件存放路径\u003e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 /* DO NOT EDIT THIS FILE - it is machine generated */ #include /* Header for class Java2C */ #ifndef _Included_Java2C #define _Included_Java2C #ifdef __cplusplus extern \"C\" { #endif /* * Class: Java2C * Method: average * Signature: (II)D */ JNIEXPORT jdouble JNICALL Java_Java2C_average (JNIEnv *, jobject, jint, jint); /* * Class: Java2C * Method: sayHello * Signature: (Ljava/lang/String;)Ljava/lang/String; */ JNIEXPORT jstring JNICALL Java_Java2C_sayHello (JNIEnv *, jobject, jstring); /* * Class: Java2C * Method: sumAndAverage * Signature: ([I)[D */ JNIEXPORT jdoubleArray JNICALL Java_Java2C_sumAndAverage (JNIEnv *, jobject, jintArray); /* * Class: Java2C * Method: num2Str * Signature: ([I)[Ljava/lang/String; */ JNIEXPORT jobjectArray JNICALL Java_Java2C_num2Str (JNIEnv *, jobject, jintArray); /* * Class: Java2C * Method: modifyJavaVariable * Signature: ()V */ JNIEXPORT void JNICALL Java_Java2C_modifyJavaVariable (JNIEnv *, jobject); /* * Class: Java2C * Method: testCallbackMethod * Signature: ()V */ JNIEXPORT void JNICALL Java_Java2C_testCallbackMethod (JNIEnv *, jobject); #ifdef __cplusplus } #endif #endif 在C文件中编写相关jni native方法的实现 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 #include #include #include \"Java2C.h\" JNIEXPORT jdouble JNICALL Java_Java2C_average (JNIEnv *env, jobject thisObj, jint n1, jint n2) { jdouble result; printf(\"In C, the numbers are %d and %d\\n\", n1, n2); result = ((jdouble)n1 + n2) / 2.0; return result; } JNIEXPORT jstring JNICALL Java_Java2C_sayHello (JNIEnv *env, jobject thisObj, jstring inJNIStr) { const char *inCStr = (*env)-\u003eGetStringUTFChars(env, inJNIStr, NULL); if (NULL == inCStr) return NULL; printf(\"In C, the receiving string is: %s\\n\", inCStr); (*env)-\u003eReleaseStringUTFChars(env, inJNIStr, inCStr); char outCStr[128] = \"Out string from C\"; return (*env)-\u003eNewStringUTF(env, outCStr); } JNIEXPORT jdoubleArray JNICALL Java_Java2C_sumAndAverage (JNIEnv *env, jobject thisObj, jintArray inJNIArray) { jint *inCArray = (*env)-\u003eGetIntArrayElements(env, inJNIArray, NULL); if (NULL == inCArray) return NULL; jsize length = (*env)-\u003eGetArrayLength(env, inJNIArray); jint sum = 0; int i; for (i = 0;i\u003clength;i++) { sum += inCArray[i]; } jdouble average = (jdouble)sum / length; (*env)-\u003eReleaseIntArrayElements(env, inJNIArray, inCArray, 0); jdouble outArray[] = {sum, average}; jdoubleArray outJNIArray = (*env)-\u003eNewDoubleArray(env, 2); if (NULL == outJNIArray) return NULL; (*env)-\u003eSetDoubleArrayRegion(env, outJNIArray, 0, 2, outArray); return outJNIArray; } JNIEXPORT jobjectArray JNICALL Java_Java2C_num2Str (JNIEnv *env, jobject thisObj, jintArray inJNIArray) { jobjectArray ret; jint *inCArray = (*env)-\u003eGetIntArrayElements(env, inJNIArray, NULL); if (NULL == inCArray) return NULL; jsize length = (*env)-\u003eGetArrayLength(env, inJNIArray); char cStrArray[6][128]; int i; for (i = 0;i \u003c length; i++) { snprintf(cStrArray[i], 128, \"%d\", inCArray[i]); } jclass strClass = (*env)-\u003eFindClass(env, \"java/lang/String\"); ret = (*env)-\u003eNewObjectArray(env, length, strClass, (*env)-\u003eNewStringUTF(env, \"\")); for (i=0;i\u003clength;i++) { (*env)-\u003eSetObjectArrayElement(env, ret, i, (*env)-\u003eNewStringUTF(env, cStrArray[i])); } return ret; } JNIEXPORT void JNICALL Java_Java2C_modifyJavaVariable (JNIEnv *env, jobject thisObj) { jclass thisClass = (*env)-\u003eGetObjectClass(env, thisObj); jfieldID fidNumber = (*env)-\u003eGetFieldID(env, thisClass, \"number\", \"I\"); if (NULL == fidNumber) return; jint number = (*env)-\u003eGetIntField(env, thisObj, fidNumber); printf(\"In C, thi int is %d\\n\", number); number = 99; (*env)-\u003eSetIntField(env, thisObj, fidNumber, number); jfieldID fidMessage = (*env)-\u003eGetFieldID(env, thisClass, \"message\", \"Ljava/lang/String;\"); if (NULL == fidMessage) return ; jstring message = (*env)-\u003eGetObjectField(env, thisObj, fidMessage); const char* cStr = (*env)-\u003eGetStringUTFChars(env, message, NULL); if (NULL == cStr) return ; printf(\"In C, the string is %s\\n\", cStr); (*env)-\u003eReleaseStringUTFChars(env, message, cStr); message = (*env)-\u003eNewStringUTF(env, \"Hello from C\"); if (NULL == message) return ; (*env)-\u003eSetObjectField(env, thisObj, fidMessage, message); jfieldID fidSpeed = (*env)-\u003eGetStaticFieldID(env, thisClass, \"speed\", \"D\"); if (NULL == fidSpeed) return ; jdouble speed = (*env)-\u003eGetStaticDoubleField(env, thisClass, fidSpeed); printf(\"In C, the speed is %f\\n\", speed); speed = 77.99; (*env)-\u003eSetStaticDoubleField(env, thisClass, fidSpeed, speed); } JNIEXPORT void JNICALL Java_Java2C_testCallbackMethod (JNIEnv *env, jobject thisObj) { jclass thisClass = (*env)-\u003eGetObjectClass(env, thisObj); jmethodID midCallback = (*env)-\u003eGetMethodID(env, thisClass, \"callback\", \"(Ljava/lang/String;)V\"); if (NULL == midCallback) return ; printf(\"In C, call back Java's callback(String)\\n\"); jstring message = (*env)-\u003eNewStringUTF(env, \"Hello from C\"); (*env)-\u003eCallVoidMethod(env, thisObj, midCallback, message); jmethodID midCallbackAverage = (*env)-\u003eGetMethodID(env, thisClass, \"callbackAverage\", \"(II)D\"); if (NULL == midCallbackAverage) return ; printf(\"In C, call back Java's callbackAverage\\n\"); jdouble average = (*env)-\u003eCallDoubleMethod(env, thisObj, midCallbackAverage, 2, 3); printf(\"In C, the average is %f\\n\", average); jmethodID midCallbackStatic = (*env)-\u003eGetStaticMethodID(env, thisClass, \"callbackStatic\", \"()Ljava/lang/String;\"); if (NULL == midCallbackStatic) { printf(\"1111\\n\"); return ; } jstring resultJNIStr = (*env)-\u003eCallStaticObjectMethod(env, thisClass, midCallbackStatic); if (NULL == resultJNIStr) return ; const char* resultCStr = (*env)-\u003eGetStringUTFChars(env, resultJNIStr, NULL); if (NULL == resultCStr) return; printf(\"In C, the returned string is %s\\n\", resultCStr); } 通过gcc/g++ 生成动态库 gcc -fPIC -I\"$JAVA_HOME/include\" -I\"$JAVA_HOME/include/linux\" -shared -o libjni.so Java2C.c\n运行进行测试 java -Djava.library.path=. Java2C 这里需要使用-D指定前面生的动态库路径，否则运行的时候会提示找不到动态库的错误\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 In C, the numbers are 5 and 6 primitive type: the average of 5 and 6 is 5.5 Reference type: In C, the receiving string is: Hello From Java Out string from C primitive type array: In Java, the sum is 66.0 In Java, the average is 22.0 reference type array: In Java the string is 11 22 33 Operate java variable: In C, thi int is 88 In C, the string is Hello from Java. In C, the speed is 55.660000 C/C++　call java viarable and method In C, call back Java's callback(String) In Java with Hello from C In C, call back Java's callbackAverage In C, the average is 2.500000 In C, the returned string is From static Java method. JNI中类型的对应关系与转换 基于数据类型 Java类型 Native Type 描述 boolean jboolean C/C++无符号的8位整型（unsigned char） byte jbyte C/C++带符号的8位整型（char） char jchar C/C++无符号的16位整型（unsigned short） short jshort C/C++带符号的16位整型 （signed short) int jint C/C++带符号的32位整型（int） long jlong C/C++带符号的64位整型（long） float jfloat C/C++32位浮点型（float） double jdouble C/C++64位浮点型（double） 引用数据类型 Java类型 Native Type 描述 Object jobject 任何Java对象，或者没有对应java类型的对象 Class jclass Class类对象 String jstring 字符串对象 Object[] jobjectArray 任何对象的数组 boolean[] jbooleanArray 布尔型数组 byte[] jbyteArray 比特型数组 char[] jcharArray 字符型数组 short[] jshortArray 短整型数组 int[] jintArray 整型数组 long[] jlongArray 长整型数组 float[] jfloatArray 单精度浮点型数组 double[] jdouble 双精度浮点型数组 void void n/a 引用类型的继承关系\n注意 基本数据类型可以在native层直接使用 引用数据类型则不能直接使用，需要根据JNI函数进行相应的转换才能使用 多维数据（包括二维数组）都是引用类型，需要使用jobjectArray类型存取其值 JNI相关操作方法 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // native string方法 // UTF-8 String (encoded to 1-3 byte, backward compatible with 7-bit ASCII) // Can be mapped to null-terminated char-array C-string const char * GetStringUTFChars(JNIEnv *env, jstring string, jboolean *isCopy); // Returns a pointer to an array of bytes representing the string in modified UTF-8 encoding. void ReleaseStringUTFChars(JNIEnv *env, jstring string, const char *utf); // Informs the VM that the native code no longer needs access to utf. jstring NewStringUTF(JNIEnv *env, const char *bytes); // Constructs a new java.lang.String object from an array of characters in modified UTF-8 encoding. jsize GetStringUTFLength(JNIEnv *env, jstring string); // Returns the length in bytes of the modified UTF-8 representation of a string. void GetStringUTFRegion(JNIEnv *env, jstring str, jsize start, jsize length, char *buf); // Translates len number of Unicode characters beginning at offset start into modified UTF-8 encoding // and place the result in the given buffer buf. // Unicode Strings (16-bit character) const jchar * GetStringChars(JNIEnv *env, jstring string, jboolean *isCopy); // Returns a pointer to the array of Unicode characters void ReleaseStringChars(JNIEnv *env, jstring string, const jchar *chars); // Informs the VM that the native code no longer needs access to chars. jstring NewString(JNIEnv *env, const jchar *unicodeChars, jsize length); // Constructs a new java.lang.String object from an array of Unicode characters. jsize GetStringLength(JNIEnv *env, jstring string); // Returns the length (the count of Unicode characters) of a Java string. void GetStringRegion(JNIEnv *env, jstring str, jsize start, jsize length, jchar *buf); // Copies len number of Unicode characters beginning at offset start to the given buffer buf 1 2 3 4 5 6 7 8 9 10 11 // JNI Primitive Array Function // ArrayType: jintArray, jbyteArray, jshortArray, jlongArray, jfloatArray, jdoubleArray, jcharArray, jbooleanArray // PrimitiveType: int, byte, short, long, float, double, char, boolean // NativeType: jint, jbyte, jshort, jlong, jfloat, jdouble, jchar, jboolean NativeType * Get\u003cPrimitiveType\u003eArrayElements(JNIEnv *env, ArrayType array, jboolean *isCopy); void Release\u003cPrimitiveType\u003eArrayElements(JNIEnv *env, ArrayType array, NativeType *elems, jint mode); void Get\u003cPrimitiveType\u003eArrayRegion(JNIEnv *env, ArrayType array, jsize start, jsize length, NativeType *buffer); void Set\u003cPrimitiveType\u003eArrayRegion(JNIEnv *env, ArrayType array, jsize start, jsize length, const NativeType *buffer); ArrayType New\u003cPrimitiveType\u003eArray(JNIEnv *env, jsize length); void * GetPrimitiveArrayCritical(JNIEnv *env, jarray array, jboolean *isCopy); void ReleasePrimitiveArrayCritical(JNIEnv *env, jarray array, void *carray, jint mode); C/C++调用Java类中的成员变量 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // JNI操作成员变量变量 jclass GetObjectClass(JNIEnv *env, jobject obj); // Returns the class of an object. jfieldID GetFieldID(JNIEnv *env, jclass cls, const char *name, const char *sig); // Returns the field ID for an instance variable of a class. NativeType Get\u003ctype\u003eField(JNIEnv *env, jobject obj, jfieldID fieldID); void Set\u003ctype\u003eField(JNIEnv *env, jobject obj, jfieldID fieldID, NativeType value); // Get/Set the value of an instance variable of an object // \u003ctype\u003e includes each of the eight primitive types plus Object. jfieldID GetStaticFieldID(JNIEnv *env, jclass cls, const char *name, const char *sig); // Returns the field ID for a static variable of a class. NativeType GetStatic\u003ctype\u003eField(JNIEnv *env, jclass clazz, jfieldID fieldID); void SetStatic\u003ctype\u003eField(JNIEnv *env, jclass clazz, jfieldID fieldID, NativeType value); // Get/Set the value of a static variable of a class. // \u003ctype\u003e includes each of the eight primitive types plus Object. C/C++调用Java类中的成员方法 通过下面这条命令可以获取到java中方法的签名\njavas -s -p Java2C\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 Compiled from \"Java2C.java\" public class Java2C { private int number; descriptor: I private static double speed; descriptor: D private java.lang.String message; descriptor: Ljava/lang/String; public Java2C(); descriptor: ()V private native double average(int, int); descriptor: (II)D private native java.lang.String sayHello(java.lang.String); descriptor: (Ljava/lang/String;)Ljava/lang/String; private native double[] sumAndAverage(int[]); descriptor: ([I)[D private native java.lang.String[] num2Str(int[]); descriptor: ([I)[Ljava/lang/String; private native void modifyJavaVariable(); descriptor: ()V private void callback(java.lang.String); descriptor: (Ljava/lang/String;)V private double callbackAverage(int, int); descriptor: (II)D private static java.lang.String callbackStatic(); descriptor: ()Ljava/lang/String; private native void testCallbackMethod(); descriptor: ()V public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V static {}; descriptor: ()V } 再通过下面这些JNI方法变可以在C/C++代码中调用到JAVA类的成员方法了\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 jmethodID GetMethodID(JNIEnv *env, jclass cls, const char *name, const char *sig); // Returns the method ID for an instance method of a class or interface. NativeType Call\u003ctype\u003eMethod(JNIEnv *env, jobject obj, jmethodID methodID, ...); NativeType Call\u003ctype\u003eMethodA(JNIEnv *env, jobject obj, jmethodID methodID, const jvalue *args); NativeType Call\u003ctype\u003eMethodV(JNIEnv *env, jobject obj, jmethodID methodID, va_list args); // Invoke an instance method of the object. // The \u003ctype\u003e includes each of the eight primitive and Object. jmethodID GetStaticMethodID(JNIEnv *env, jclass cls, const char *name, const char *sig); // Returns the method ID for an instance method of a class or interface. NativeType CallStatic\u003ctype\u003eMethod(JNIEnv *env, jclass clazz, jmethodID methodID, ...); NativeType CallStatic\u003ctype\u003eMethodA(JNIEnv *env, jclass clazz, jmethodID methodID, const jvalue *args); NativeType CallStatic\u003ctype\u003eMethodV(JNIEnv *env, jclass clazz, jmethodID methodID, va_list args); // Invoke an instance method of the object. // The \u003ctype\u003e includes each of the eight primitive and Object. 参考 [1] Java Programming Tutorial Java Native Interface (JNI)\n","wordCount":"3090","inLanguage":"zh","image":"https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2019-03-03T22:51:59Z","dateModified":"2019-03-03T22:51:59Z","author":{"@type":"Person","name":"Marshall Liu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lyapple2008.github.io/posts/2019-03-03-javanativeinterface%E7%AC%94%E8%AE%B0/"},"publisher":{"@type":"Organization","name":"BeYoung","logo":{"@type":"ImageObject","url":"https://lyapple2008.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lyapple2008.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lyapple2008.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://lyapple2008.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://lyapple2008.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://lyapple2008.github.io/about_me/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lyapple2008.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://lyapple2008.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">JavaNativeInterface笔记</h1><div class=post-meta><span title='2019-03-03 22:51:59 +0000 UTC'>三月 3, 2019</span>&nbsp;·&nbsp;7 分钟&nbsp;·&nbsp;3090 字&nbsp;·&nbsp;Marshall Liu</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#jni操作完整流程介绍>JNI操作完整流程介绍</a></li><li><a href=#jni中类型的对应关系与转换>JNI中类型的对应关系与转换</a></li><li><a href=#cc调用java类中的成员变量>C/C++调用Java类中的成员变量</a></li><li><a href=#cc调用java类中的成员方法>C/C++调用Java类中的成员方法</a></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>最近由于公司项目的原因开始接触WebRTC，其中Android相关部分由于需要跨越了两种不同的语
言，因此需要一种机制能够让C/C++和JAVA之间进行交互，而JNI就是这样一种机制。通过JNI可
以实现C/C++和JAVA之前需要交互。本篇笔记的首先从一个实际的例子开始介绍JNI操作的完整流
程是怎样的；接着将就这个例子完整介绍JNI中需要注意的点。
<img alt=image loading=lazy src=https://user-images.githubusercontent.com/3350865/61180103-91c2e780-a643-11e9-8132-f85c7a83f8da.jpg>
<img src=/images/2019-03-03-001.jpg></p><h3 id=jni操作完整流程介绍>JNI操作完整流程介绍<a hidden class=anchor aria-hidden=true href=#jni操作完整流程介绍>#</a></h3><ul><li>编写Java类及声明Native方法</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>public</span> <span class=k>class</span> <span class=n>Java2C</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>loadLibrary</span><span class=p>(</span><span class=s2>&#34;jni&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>成员变量</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=ne>int</span> <span class=n>number</span> <span class=o>=</span> <span class=mi>88</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=k>static</span> <span class=n>double</span> <span class=n>speed</span> <span class=o>=</span> <span class=mf>55.66</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=ne>String</span> <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;Hello from Java.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>基本数据类型</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>native</span> <span class=n>double</span> <span class=n>average</span><span class=p>(</span><span class=ne>int</span> <span class=n>n1</span><span class=p>,</span> <span class=ne>int</span> <span class=n>n2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>引用类型</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>native</span> <span class=ne>String</span> <span class=n>sayHello</span><span class=p>(</span><span class=ne>String</span> <span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>基本数据类型数组</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>native</span> <span class=n>double</span><span class=p>[]</span> <span class=n>sumAndAverage</span><span class=p>(</span><span class=ne>int</span><span class=p>[]</span> <span class=n>numbers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>引用类型数组</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>native</span> <span class=ne>String</span><span class=p>[]</span> <span class=n>num2Str</span><span class=p>(</span><span class=ne>int</span><span class=p>[]</span> <span class=n>numbers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>操作</span><span class=n>java成员变量</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>native</span> <span class=n>void</span> <span class=n>modifyJavaVariable</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>java成员方法</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>void</span> <span class=n>callback</span><span class=p>(</span><span class=ne>String</span> <span class=n>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;In Java with &#34;</span> <span class=o>+</span> <span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>double</span> <span class=n>callbackAverage</span><span class=p>(</span><span class=ne>int</span> <span class=n>n1</span><span class=p>,</span> <span class=ne>int</span> <span class=n>n2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>((</span><span class=n>double</span><span class=p>)</span><span class=n>n1</span> <span class=o>+</span> <span class=n>n2</span><span class=p>)</span> <span class=o>/</span> <span class=mf>2.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>静态成员方法</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=k>static</span> <span class=ne>String</span> <span class=n>callbackStatic</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;From static Java method.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>native</span> <span class=n>void</span> <span class=n>testCallbackMethod</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>void</span> <span class=n>main</span><span class=p>(</span><span class=ne>String</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Java2C</span> <span class=n>javaClass</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Java2C</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>double</span> <span class=n>aver</span> <span class=o>=</span> <span class=n>javaClass</span><span class=o>.</span><span class=n>average</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;primitive type: the average of 5 and 6 is &#34;</span> <span class=o>+</span> <span class=n>aver</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;Reference type: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=ne>String</span> <span class=n>javaString</span> <span class=o>=</span> <span class=n>javaClass</span><span class=o>.</span><span class=n>sayHello</span><span class=p>(</span><span class=s2>&#34;Hello From Java&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=n>javaString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;primitive type array: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=ne>int</span><span class=p>[]</span> <span class=n>numbers</span> <span class=o>=</span> <span class=p>{</span><span class=mi>11</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>33</span><span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>double</span><span class=p>[]</span> <span class=n>results</span> <span class=o>=</span> <span class=n>javaClass</span><span class=o>.</span><span class=n>sumAndAverage</span><span class=p>(</span><span class=n>numbers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;In Java, the sum is &#34;</span> <span class=o>+</span> <span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;In Java, the average is &#34;</span> <span class=o>+</span> <span class=n>results</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;reference type array: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=ne>String</span><span class=p>[]</span> <span class=n>numStrs</span> <span class=o>=</span> <span class=n>javaClass</span><span class=o>.</span><span class=n>num2Str</span><span class=p>(</span><span class=n>numbers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;In Java the string is &#34;</span> <span class=o>+</span> <span class=n>numStrs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=n>numStrs</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=n>numStrs</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;Operate java variable: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>javaClass</span><span class=o>.</span><span class=n>modifyJavaVariable</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;C/C++　call java viarable and method&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>javaClass</span><span class=o>.</span><span class=n>testCallbackMethod</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>生成jni native头文件</li></ul><blockquote><p>javac -h &lt;头文件存放路径> &lt;java类></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* DO NOT EDIT THIS FILE - it is machine generated */</span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;jni.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=cm>/* Header for class Java2C */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#ifndef _Included_Java2C
</span></span></span><span class=line><span class=cl><span class=cp>#define _Included_Java2C
</span></span></span><span class=line><span class=cl><span class=cp>#ifdef __cplusplus
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Class:     Java2C
</span></span></span><span class=line><span class=cl><span class=cm> * Method:    average
</span></span></span><span class=line><span class=cl><span class=cm> * Signature: (II)D
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jdouble</span> <span class=n>JNICALL</span> <span class=nf>Java_Java2C_average</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>,</span> <span class=n>jint</span><span class=p>,</span> <span class=n>jint</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Class:     Java2C
</span></span></span><span class=line><span class=cl><span class=cm> * Method:    sayHello
</span></span></span><span class=line><span class=cl><span class=cm> * Signature: (Ljava/lang/String;)Ljava/lang/String;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jstring</span> <span class=n>JNICALL</span> <span class=nf>Java_Java2C_sayHello</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>,</span> <span class=n>jstring</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Class:     Java2C
</span></span></span><span class=line><span class=cl><span class=cm> * Method:    sumAndAverage
</span></span></span><span class=line><span class=cl><span class=cm> * Signature: ([I)[D
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jdoubleArray</span> <span class=n>JNICALL</span> <span class=nf>Java_Java2C_sumAndAverage</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>,</span> <span class=n>jintArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Class:     Java2C
</span></span></span><span class=line><span class=cl><span class=cm> * Method:    num2Str
</span></span></span><span class=line><span class=cl><span class=cm> * Signature: ([I)[Ljava/lang/String;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jobjectArray</span> <span class=n>JNICALL</span> <span class=nf>Java_Java2C_num2Str</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>,</span> <span class=n>jintArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Class:     Java2C
</span></span></span><span class=line><span class=cl><span class=cm> * Method:    modifyJavaVariable
</span></span></span><span class=line><span class=cl><span class=cm> * Signature: ()V
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=kt>void</span> <span class=n>JNICALL</span> <span class=nf>Java_Java2C_modifyJavaVariable</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Class:     Java2C
</span></span></span><span class=line><span class=cl><span class=cm> * Method:    testCallbackMethod
</span></span></span><span class=line><span class=cl><span class=cm> * Signature: ()V
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=kt>void</span> <span class=n>JNICALL</span> <span class=nf>Java_Java2C_testCallbackMethod</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=p>,</span> <span class=n>jobject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#ifdef __cplusplus
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></td></tr></table></div></div><ul><li>在C文件中编写相关jni native方法的实现</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1>#include &lt;jni.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &#34;Java2C.h&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jdouble</span> <span class=n>JNICALL</span> <span class=n>Java_Java2C_average</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>jint</span> <span class=n>n1</span><span class=p>,</span> <span class=n>jint</span> <span class=n>n2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>jdouble</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, the numbers are </span><span class=si>%d</span><span class=s2> and </span><span class=si>%d</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>n1</span><span class=p>,</span> <span class=n>n2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=p>((</span><span class=n>jdouble</span><span class=p>)</span><span class=n>n1</span> <span class=o>+</span> <span class=n>n2</span><span class=p>)</span> <span class=o>/</span> <span class=mf>2.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jstring</span> <span class=n>JNICALL</span> <span class=n>Java_Java2C_sayHello</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>inJNIStr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>inCStr</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetStringUTFChars</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIStr</span><span class=p>,</span> <span class=n>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>inCStr</span><span class=p>)</span> <span class=k>return</span> <span class=n>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, the receiving string is: </span><span class=si>%s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>inCStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>ReleaseStringUTFChars</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIStr</span><span class=p>,</span> <span class=n>inCStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>char</span> <span class=n>outCStr</span><span class=p>[</span><span class=mi>128</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Out string from C&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>outCStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jdoubleArray</span> <span class=n>JNICALL</span> <span class=n>Java_Java2C_sumAndAverage</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>jintArray</span> <span class=n>inJNIArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>jint</span> <span class=o>*</span><span class=n>inCArray</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetIntArrayElements</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIArray</span><span class=p>,</span> <span class=n>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>inCArray</span><span class=p>)</span> <span class=k>return</span> <span class=n>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>jsize</span> <span class=n>length</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetArrayLength</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jint</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=ne>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>length</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>sum</span> <span class=o>+=</span> <span class=n>inCArray</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=n>jdouble</span> <span class=n>average</span> <span class=o>=</span> <span class=p>(</span><span class=n>jdouble</span><span class=p>)</span><span class=n>sum</span> <span class=o>/</span> <span class=n>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>ReleaseIntArrayElements</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIArray</span><span class=p>,</span> <span class=n>inCArray</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jdouble</span> <span class=n>outArray</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=n>sum</span><span class=p>,</span> <span class=n>average</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jdoubleArray</span> <span class=n>outJNIArray</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewDoubleArray</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>outJNIArray</span><span class=p>)</span> <span class=k>return</span> <span class=n>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>SetDoubleArrayRegion</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>outJNIArray</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>outArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>outJNIArray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>jobjectArray</span> <span class=n>JNICALL</span> <span class=n>Java_Java2C_num2Str</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>jintArray</span> <span class=n>inJNIArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>jobjectArray</span> <span class=n>ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>jint</span> <span class=o>*</span><span class=n>inCArray</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetIntArrayElements</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIArray</span><span class=p>,</span> <span class=n>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>inCArray</span><span class=p>)</span> <span class=k>return</span> <span class=n>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>jsize</span> <span class=n>length</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetArrayLength</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>inJNIArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>char</span> <span class=n>cStrArray</span><span class=p>[</span><span class=mi>6</span><span class=p>][</span><span class=mi>128</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=ne>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>snprintf</span><span class=p>(</span><span class=n>cStrArray</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=mi>128</span><span class=p>,</span> <span class=s2>&#34;</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>inCArray</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jclass</span> <span class=n>strClass</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>FindClass</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=s2>&#34;java/lang/String&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>ret</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewObjectArray</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>length</span><span class=p>,</span> <span class=n>strClass</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>length</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>SetObjectArrayElement</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>ret</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>cStrArray</span><span class=p>[</span><span class=n>i</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>JNIEXPORT</span> <span class=n>void</span> <span class=n>JNICALL</span> <span class=n>Java_Java2C_modifyJavaVariable</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>thisObj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>jclass</span> <span class=n>thisClass</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetObjectClass</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jfieldID</span> <span class=n>fidNumber</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetFieldID</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=s2>&#34;number&#34;</span><span class=p>,</span> <span class=s2>&#34;I&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>fidNumber</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jint</span> <span class=n>number</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetIntField</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>fidNumber</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, thi int is </span><span class=si>%d</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>number</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>number</span> <span class=o>=</span> <span class=mi>99</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>SetIntField</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>fidNumber</span><span class=p>,</span> <span class=n>number</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jfieldID</span> <span class=n>fidMessage</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetFieldID</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span> <span class=s2>&#34;Ljava/lang/String;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>fidMessage</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jstring</span> <span class=n>message</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetObjectField</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>fidMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>const</span> <span class=n>char</span><span class=o>*</span> <span class=n>cStr</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetStringUTFChars</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>cStr</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, the string is </span><span class=si>%s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>cStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>ReleaseStringUTFChars</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>cStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>message</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=s2>&#34;Hello from C&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>message</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>SetObjectField</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>fidMessage</span><span class=p>,</span> <span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jfieldID</span> <span class=n>fidSpeed</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetStaticFieldID</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=s2>&#34;speed&#34;</span><span class=p>,</span> <span class=s2>&#34;D&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>fidSpeed</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jdouble</span> <span class=n>speed</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetStaticDoubleField</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=n>fidSpeed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, the speed is </span><span class=si>%f</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>speed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>speed</span> <span class=o>=</span> <span class=mf>77.99</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>SetStaticDoubleField</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=n>fidSpeed</span><span class=p>,</span> <span class=n>speed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>JNIEXPORT</span> <span class=n>void</span> <span class=n>JNICALL</span> <span class=n>Java_Java2C_testCallbackMethod</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>thisObj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>jclass</span> <span class=n>thisClass</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetObjectClass</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jmethodID</span> <span class=n>midCallback</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=s2>&#34;callback&#34;</span><span class=p>,</span> <span class=s2>&#34;(Ljava/lang/String;)V&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>midCallback</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, call back Java&#39;s callback(String)</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>jstring</span> <span class=n>message</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=s2>&#34;Hello from C&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>CallVoidMethod</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>midCallback</span><span class=p>,</span> <span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jmethodID</span> <span class=n>midCallbackAverage</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=s2>&#34;callbackAverage&#34;</span><span class=p>,</span> <span class=s2>&#34;(II)D&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>midCallbackAverage</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, call back Java&#39;s callbackAverage</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>jdouble</span> <span class=n>average</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>CallDoubleMethod</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisObj</span><span class=p>,</span> <span class=n>midCallbackAverage</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, the average is </span><span class=si>%f</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>average</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>jmethodID</span> <span class=n>midCallbackStatic</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetStaticMethodID</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=s2>&#34;callbackStatic&#34;</span><span class=p>,</span> <span class=s2>&#34;()Ljava/lang/String;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>midCallbackStatic</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;1111</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=n>jstring</span> <span class=n>resultJNIStr</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>CallStaticObjectMethod</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>thisClass</span><span class=p>,</span> <span class=n>midCallbackStatic</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>resultJNIStr</span><span class=p>)</span> <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>const</span> <span class=n>char</span><span class=o>*</span> <span class=n>resultCStr</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=n>env</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>GetStringUTFChars</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>resultJNIStr</span><span class=p>,</span> <span class=n>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>==</span> <span class=n>resultCStr</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;In C, the returned string is </span><span class=si>%s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>resultCStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>通过gcc/g++ 生成动态库</li></ul><blockquote><p>gcc -fPIC -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/linux" -shared -o libjni.so Java2C.c</p></blockquote><ul><li>运行进行测试</li></ul><blockquote><p>java -Djava.library.path=. Java2C<br>这里需要使用-D指定前面生的动态库路径，否则运行的时候会提示找不到动态库的错误</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>the</span> <span class=n>numbers</span> <span class=n>are</span> <span class=mi>5</span> <span class=ow>and</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>primitive</span> <span class=n>type</span><span class=p>:</span> <span class=n>the</span> <span class=n>average</span> <span class=n>of</span> <span class=mi>5</span> <span class=ow>and</span> <span class=mi>6</span> <span class=n>is</span> <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=ne>Reference</span> <span class=n>type</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>the</span> <span class=n>receiving</span> <span class=n>string</span> <span class=n>is</span><span class=p>:</span> <span class=n>Hello</span> <span class=n>From</span> <span class=n>Java</span>
</span></span><span class=line><span class=cl><span class=n>Out</span> <span class=n>string</span> <span class=n>from</span> <span class=n>C</span>
</span></span><span class=line><span class=cl><span class=n>primitive</span> <span class=n>type</span> <span class=n>array</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>Java</span><span class=p>,</span> <span class=n>the</span> <span class=n>sum</span> <span class=n>is</span> <span class=mf>66.0</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>Java</span><span class=p>,</span> <span class=n>the</span> <span class=n>average</span> <span class=n>is</span> <span class=mf>22.0</span>
</span></span><span class=line><span class=cl><span class=n>reference</span> <span class=n>type</span> <span class=n>array</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>Java</span> <span class=n>the</span> <span class=n>string</span> <span class=n>is</span> <span class=mi>11</span> <span class=mi>22</span> <span class=mi>33</span>
</span></span><span class=line><span class=cl><span class=n>Operate</span> <span class=n>java</span> <span class=n>variable</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>thi</span> <span class=ne>int</span> <span class=n>is</span> <span class=mi>88</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>the</span> <span class=n>string</span> <span class=n>is</span> <span class=n>Hello</span> <span class=n>from</span> <span class=n>Java</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>the</span> <span class=n>speed</span> <span class=n>is</span> <span class=mf>55.660000</span>
</span></span><span class=line><span class=cl><span class=n>C</span><span class=o>/</span><span class=n>C</span><span class=o>++</span>　<span class=n>call</span> <span class=n>java</span> <span class=n>viarable</span> <span class=ow>and</span> <span class=n>method</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>call</span> <span class=n>back</span> <span class=n>Java</span><span class=s1>&#39;s callback(String)</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>Java</span> <span class=n>with</span> <span class=n>Hello</span> <span class=n>from</span> <span class=n>C</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>call</span> <span class=n>back</span> <span class=n>Java</span><span class=s1>&#39;s callbackAverage</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>the</span> <span class=n>average</span> <span class=n>is</span> <span class=mf>2.500000</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>C</span><span class=p>,</span> <span class=n>the</span> <span class=n>returned</span> <span class=n>string</span> <span class=n>is</span> <span class=n>From</span> <span class=k>static</span> <span class=n>Java</span> <span class=n>method</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=jni中类型的对应关系与转换>JNI中类型的对应关系与转换<a hidden class=anchor aria-hidden=true href=#jni中类型的对应关系与转换>#</a></h3><ul><li>基于数据类型</li></ul><table><thead><tr><th>Java类型</th><th>Native Type</th><th>描述</th></tr></thead><tbody><tr><td>boolean</td><td>jboolean</td><td>C/C++无符号的8位整型（unsigned char）</td></tr><tr><td>byte</td><td>jbyte</td><td>C/C++带符号的8位整型（char）</td></tr><tr><td>char</td><td>jchar</td><td>C/C++无符号的16位整型（unsigned short）</td></tr><tr><td>short</td><td>jshort</td><td>C/C++带符号的16位整型 （signed short)</td></tr><tr><td>int</td><td>jint</td><td>C/C++带符号的32位整型（int）</td></tr><tr><td>long</td><td>jlong</td><td>C/C++带符号的64位整型（long）</td></tr><tr><td>float</td><td>jfloat</td><td>C/C++32位浮点型（float）</td></tr><tr><td>double</td><td>jdouble</td><td>C/C++64位浮点型（double）</td></tr></tbody></table><ul><li>引用数据类型</li></ul><table><thead><tr><th>Java类型</th><th>Native Type</th><th>描述</th></tr></thead><tbody><tr><td>Object</td><td>jobject</td><td>任何Java对象，或者没有对应java类型的对象</td></tr><tr><td>Class</td><td>jclass</td><td>Class类对象</td></tr><tr><td>String</td><td>jstring</td><td>字符串对象</td></tr><tr><td>Object[]</td><td>jobjectArray</td><td>任何对象的数组</td></tr><tr><td>boolean[]</td><td>jbooleanArray</td><td>布尔型数组</td></tr><tr><td>byte[]</td><td>jbyteArray</td><td>比特型数组</td></tr><tr><td>char[]</td><td>jcharArray</td><td>字符型数组</td></tr><tr><td>short[]</td><td>jshortArray</td><td>短整型数组</td></tr><tr><td>int[]</td><td>jintArray</td><td>整型数组</td></tr><tr><td>long[]</td><td>jlongArray</td><td>长整型数组</td></tr><tr><td>float[]</td><td>jfloatArray</td><td>单精度浮点型数组</td></tr><tr><td>double[]</td><td>jdouble</td><td>双精度浮点型数组</td></tr><tr><td>void</td><td>void</td><td>n/a</td></tr></tbody></table><ul><li>引用类型的继承关系<br><img alt=image loading=lazy src=https://user-images.githubusercontent.com/3350865/61180104-94254180-a643-11e9-815b-2f3460940ae2.jpg></li><li>注意</li></ul><blockquote><ol><li>基本数据类型可以在native层直接使用</li><li>引用数据类型则不能直接使用，需要根据JNI函数进行相应的转换才能使用</li><li>多维数据（包括二维数组）都是引用类型，需要使用jobjectArray类型存取其值</li></ol></blockquote><ul><li>JNI相关操作方法</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span> <span class=n>native</span> <span class=n>string方法</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span> <span class=ne>String</span> <span class=p>(</span><span class=n>encoded</span> <span class=n>to</span> <span class=mi>1</span><span class=o>-</span><span class=mi>3</span> <span class=n>byte</span><span class=p>,</span> <span class=n>backward</span> <span class=n>compatible</span> <span class=n>with</span> <span class=mi>7</span><span class=o>-</span><span class=n>bit</span> <span class=n>ASCII</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>Can</span> <span class=n>be</span> <span class=n>mapped</span> <span class=n>to</span> <span class=n>null</span><span class=o>-</span><span class=n>terminated</span> <span class=n>char</span><span class=o>-</span><span class=n>array</span> <span class=n>C</span><span class=o>-</span><span class=n>string</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>char</span> <span class=o>*</span> <span class=n>GetStringUTFChars</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>string</span><span class=p>,</span> <span class=n>jboolean</span> <span class=o>*</span><span class=n>isCopy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>a</span> <span class=n>pointer</span> <span class=n>to</span> <span class=n>an</span> <span class=n>array</span> <span class=n>of</span> <span class=n>bytes</span> <span class=n>representing</span> <span class=n>the</span> <span class=n>string</span> <span class=ow>in</span> <span class=n>modified</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span> <span class=n>encoding</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>ReleaseStringUTFChars</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>string</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>utf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Informs</span> <span class=n>the</span> <span class=n>VM</span> <span class=n>that</span> <span class=n>the</span> <span class=n>native</span> <span class=n>code</span> <span class=n>no</span> <span class=n>longer</span> <span class=n>needs</span> <span class=n>access</span> <span class=n>to</span> <span class=n>utf</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>jstring</span> <span class=n>NewStringUTF</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>bytes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Constructs</span> <span class=n>a</span> <span class=n>new</span> <span class=n>java</span><span class=o>.</span><span class=n>lang</span><span class=o>.</span><span class=n>String</span> <span class=n>object</span> <span class=n>from</span> <span class=n>an</span> <span class=n>array</span> <span class=n>of</span> <span class=n>characters</span> <span class=ow>in</span> <span class=n>modified</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span> <span class=n>encoding</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>jsize</span> <span class=n>GetStringUTFLength</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=n>length</span> <span class=ow>in</span> <span class=n>bytes</span> <span class=n>of</span> <span class=n>the</span> <span class=n>modified</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span> <span class=n>representation</span> <span class=n>of</span> <span class=n>a</span> <span class=n>string</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>GetStringUTFRegion</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=nb>str</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>start</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>length</span><span class=p>,</span> <span class=n>char</span> <span class=o>*</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Translates</span> <span class=n>len</span> <span class=n>number</span> <span class=n>of</span> <span class=n>Unicode</span> <span class=n>characters</span> <span class=n>beginning</span> <span class=n>at</span> <span class=n>offset</span> <span class=n>start</span> <span class=n>into</span> <span class=n>modified</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span> <span class=n>encoding</span> 
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=ow>and</span> <span class=n>place</span> <span class=n>the</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>given</span> <span class=n>buffer</span> <span class=n>buf</span><span class=o>.</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>Unicode</span> <span class=n>Strings</span> <span class=p>(</span><span class=mi>16</span><span class=o>-</span><span class=n>bit</span> <span class=n>character</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>jchar</span> <span class=o>*</span> <span class=n>GetStringChars</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>string</span><span class=p>,</span> <span class=n>jboolean</span> <span class=o>*</span><span class=n>isCopy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>a</span> <span class=n>pointer</span> <span class=n>to</span> <span class=n>the</span> <span class=n>array</span> <span class=n>of</span> <span class=n>Unicode</span> <span class=n>characters</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>ReleaseStringChars</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>string</span><span class=p>,</span> <span class=k>const</span> <span class=n>jchar</span> <span class=o>*</span><span class=n>chars</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Informs</span> <span class=n>the</span> <span class=n>VM</span> <span class=n>that</span> <span class=n>the</span> <span class=n>native</span> <span class=n>code</span> <span class=n>no</span> <span class=n>longer</span> <span class=n>needs</span> <span class=n>access</span> <span class=n>to</span> <span class=n>chars</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>jstring</span> <span class=n>NewString</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=k>const</span> <span class=n>jchar</span> <span class=o>*</span><span class=n>unicodeChars</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Constructs</span> <span class=n>a</span> <span class=n>new</span> <span class=n>java</span><span class=o>.</span><span class=n>lang</span><span class=o>.</span><span class=n>String</span> <span class=n>object</span> <span class=n>from</span> <span class=n>an</span> <span class=n>array</span> <span class=n>of</span> <span class=n>Unicode</span> <span class=n>characters</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>jsize</span> <span class=n>GetStringLength</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=n>length</span> <span class=p>(</span><span class=n>the</span> <span class=n>count</span> <span class=n>of</span> <span class=n>Unicode</span> <span class=n>characters</span><span class=p>)</span> <span class=n>of</span> <span class=n>a</span> <span class=n>Java</span> <span class=n>string</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>GetStringRegion</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=nb>str</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>start</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>length</span><span class=p>,</span> <span class=n>jchar</span> <span class=o>*</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Copies</span> <span class=n>len</span> <span class=n>number</span> <span class=n>of</span> <span class=n>Unicode</span> <span class=n>characters</span> <span class=n>beginning</span> <span class=n>at</span> <span class=n>offset</span> <span class=n>start</span> <span class=n>to</span> <span class=n>the</span> <span class=n>given</span> <span class=n>buffer</span> <span class=n>buf</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span> <span class=n>JNI</span> <span class=n>Primitive</span> <span class=ne>Array</span> <span class=n>Function</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>ArrayType</span><span class=p>:</span> <span class=n>jintArray</span><span class=p>,</span> <span class=n>jbyteArray</span><span class=p>,</span> <span class=n>jshortArray</span><span class=p>,</span> <span class=n>jlongArray</span><span class=p>,</span> <span class=n>jfloatArray</span><span class=p>,</span> <span class=n>jdoubleArray</span><span class=p>,</span> <span class=n>jcharArray</span><span class=p>,</span> <span class=n>jbooleanArray</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>PrimitiveType</span><span class=p>:</span> <span class=ne>int</span><span class=p>,</span> <span class=n>byte</span><span class=p>,</span> <span class=n>short</span><span class=p>,</span> <span class=n>long</span><span class=p>,</span> <span class=ne>float</span><span class=p>,</span> <span class=n>double</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>boolean</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>NativeType</span><span class=p>:</span> <span class=n>jint</span><span class=p>,</span> <span class=n>jbyte</span><span class=p>,</span> <span class=n>jshort</span><span class=p>,</span> <span class=n>jlong</span><span class=p>,</span> <span class=n>jfloat</span><span class=p>,</span> <span class=n>jdouble</span><span class=p>,</span> <span class=n>jchar</span><span class=p>,</span> <span class=n>jboolean</span>
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=o>*</span> <span class=n>Get</span><span class=o>&lt;</span><span class=n>PrimitiveType</span><span class=o>&gt;</span><span class=n>ArrayElements</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>ArrayType</span> <span class=n>array</span><span class=p>,</span> <span class=n>jboolean</span> <span class=o>*</span><span class=n>isCopy</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>Release</span><span class=o>&lt;</span><span class=n>PrimitiveType</span><span class=o>&gt;</span><span class=n>ArrayElements</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>ArrayType</span> <span class=n>array</span><span class=p>,</span> <span class=n>NativeType</span> <span class=o>*</span><span class=n>elems</span><span class=p>,</span> <span class=n>jint</span> <span class=n>mode</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>Get</span><span class=o>&lt;</span><span class=n>PrimitiveType</span><span class=o>&gt;</span><span class=n>ArrayRegion</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>ArrayType</span> <span class=n>array</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>start</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>length</span><span class=p>,</span> <span class=n>NativeType</span> <span class=o>*</span><span class=n>buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>PrimitiveType</span><span class=o>&gt;</span><span class=n>ArrayRegion</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>ArrayType</span> <span class=n>array</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>start</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>length</span><span class=p>,</span> <span class=k>const</span> <span class=n>NativeType</span> <span class=o>*</span><span class=n>buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>ArrayType</span> <span class=n>New</span><span class=o>&lt;</span><span class=n>PrimitiveType</span><span class=o>&gt;</span><span class=ne>Array</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jsize</span> <span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=o>*</span> <span class=n>GetPrimitiveArrayCritical</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jarray</span> <span class=n>array</span><span class=p>,</span> <span class=n>jboolean</span> <span class=o>*</span><span class=n>isCopy</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>ReleasePrimitiveArrayCritical</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jarray</span> <span class=n>array</span><span class=p>,</span> <span class=n>void</span> <span class=o>*</span><span class=n>carray</span><span class=p>,</span> <span class=n>jint</span> <span class=n>mode</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cc调用java类中的成员变量>C/C++调用Java类中的成员变量<a hidden class=anchor aria-hidden=true href=#cc调用java类中的成员变量>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span> <span class=n>JNI操作成员变量变量</span>
</span></span><span class=line><span class=cl><span class=n>jclass</span> <span class=n>GetObjectClass</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=k>class</span> <span class=n>of</span> <span class=n>an</span> <span class=n>object</span><span class=o>.</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=n>jfieldID</span> <span class=n>GetFieldID</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>cls</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>sig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=n>field</span> <span class=n>ID</span> <span class=k>for</span> <span class=n>an</span> <span class=n>instance</span> <span class=n>variable</span> <span class=n>of</span> <span class=n>a</span> <span class=k>class</span><span class=o>.</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>Get</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>Field</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>,</span> <span class=n>jfieldID</span> <span class=n>fieldID</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>Field</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>,</span> <span class=n>jfieldID</span> <span class=n>fieldID</span><span class=p>,</span> <span class=n>NativeType</span> <span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=n>Get</span><span class=o>/</span><span class=n>Set</span> <span class=n>the</span> <span class=n>value</span> <span class=n>of</span> <span class=n>an</span> <span class=n>instance</span> <span class=n>variable</span> <span class=n>of</span> <span class=n>an</span> <span class=n>object</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span> <span class=n>includes</span> <span class=n>each</span> <span class=n>of</span> <span class=n>the</span> <span class=n>eight</span> <span class=n>primitive</span> <span class=n>types</span> <span class=n>plus</span> <span class=ne>Object</span><span class=o>.</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=n>jfieldID</span> <span class=n>GetStaticFieldID</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>cls</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>sig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=n>field</span> <span class=n>ID</span> <span class=k>for</span> <span class=n>a</span> <span class=k>static</span> <span class=n>variable</span> <span class=n>of</span> <span class=n>a</span> <span class=k>class</span><span class=o>.</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>GetStatic</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>Field</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>clazz</span><span class=p>,</span> <span class=n>jfieldID</span> <span class=n>fieldID</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>SetStatic</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>Field</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>clazz</span><span class=p>,</span> <span class=n>jfieldID</span> <span class=n>fieldID</span><span class=p>,</span> <span class=n>NativeType</span> <span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=n>Get</span><span class=o>/</span><span class=n>Set</span> <span class=n>the</span> <span class=n>value</span> <span class=n>of</span> <span class=n>a</span> <span class=k>static</span> <span class=n>variable</span> <span class=n>of</span> <span class=n>a</span> <span class=k>class</span><span class=o>.</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span> <span class=n>includes</span> <span class=n>each</span> <span class=n>of</span> <span class=n>the</span> <span class=n>eight</span> <span class=n>primitive</span> <span class=n>types</span> <span class=n>plus</span> <span class=ne>Object</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cc调用java类中的成员方法>C/C++调用Java类中的成员方法<a hidden class=anchor aria-hidden=true href=#cc调用java类中的成员方法>#</a></h3><p>通过下面这条命令可以获取到java中方法的签名</p><blockquote><p>javas -s -p Java2C</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Compiled from &#34;Java2C.java&#34;
</span></span><span class=line><span class=cl>public class Java2C {
</span></span><span class=line><span class=cl>  private int number;
</span></span><span class=line><span class=cl>    descriptor: I
</span></span><span class=line><span class=cl>  private static double speed;
</span></span><span class=line><span class=cl>    descriptor: D
</span></span><span class=line><span class=cl>  private java.lang.String message;
</span></span><span class=line><span class=cl>    descriptor: Ljava/lang/String;
</span></span><span class=line><span class=cl>  public Java2C();
</span></span><span class=line><span class=cl>    descriptor: ()V
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private native double average(int, int);
</span></span><span class=line><span class=cl>    descriptor: (II)D
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private native java.lang.String sayHello(java.lang.String);
</span></span><span class=line><span class=cl>    descriptor: (Ljava/lang/String;)Ljava/lang/String;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private native double[] sumAndAverage(int[]);
</span></span><span class=line><span class=cl>    descriptor: ([I)[D
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private native java.lang.String[] num2Str(int[]);
</span></span><span class=line><span class=cl>    descriptor: ([I)[Ljava/lang/String;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private native void modifyJavaVariable();
</span></span><span class=line><span class=cl>    descriptor: ()V
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private void callback(java.lang.String);
</span></span><span class=line><span class=cl>    descriptor: (Ljava/lang/String;)V
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private double callbackAverage(int, int);
</span></span><span class=line><span class=cl>    descriptor: (II)D
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private static java.lang.String callbackStatic();
</span></span><span class=line><span class=cl>    descriptor: ()Ljava/lang/String;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  private native void testCallbackMethod();
</span></span><span class=line><span class=cl>    descriptor: ()V
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  public static void main(java.lang.String[]);
</span></span><span class=line><span class=cl>    descriptor: ([Ljava/lang/String;)V
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  static {};
</span></span><span class=line><span class=cl>    descriptor: ()V
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>再通过下面这些JNI方法变可以在C/C++代码中调用到JAVA类的成员方法了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>jmethodID</span> <span class=n>GetMethodID</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>cls</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>sig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=n>method</span> <span class=n>ID</span> <span class=k>for</span> <span class=n>an</span> <span class=n>instance</span> <span class=n>method</span> <span class=n>of</span> <span class=n>a</span> <span class=k>class</span> <span class=ow>or</span> <span class=n>interface</span><span class=o>.</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>Call</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>Method</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>,</span> <span class=n>jmethodID</span> <span class=n>methodID</span><span class=p>,</span> <span class=o>...</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>Call</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>MethodA</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>,</span> <span class=n>jmethodID</span> <span class=n>methodID</span><span class=p>,</span> <span class=k>const</span> <span class=n>jvalue</span> <span class=o>*</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>Call</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>MethodV</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>obj</span><span class=p>,</span> <span class=n>jmethodID</span> <span class=n>methodID</span><span class=p>,</span> <span class=n>va_list</span> <span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Invoke</span> <span class=n>an</span> <span class=n>instance</span> <span class=n>method</span> <span class=n>of</span> <span class=n>the</span> <span class=n>object</span><span class=o>.</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>The</span> <span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span> <span class=n>includes</span> <span class=n>each</span> <span class=n>of</span> <span class=n>the</span> <span class=n>eight</span> <span class=n>primitive</span> <span class=ow>and</span> <span class=ne>Object</span><span class=o>.</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=n>jmethodID</span> <span class=n>GetStaticMethodID</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>cls</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>sig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Returns</span> <span class=n>the</span> <span class=n>method</span> <span class=n>ID</span> <span class=k>for</span> <span class=n>an</span> <span class=n>instance</span> <span class=n>method</span> <span class=n>of</span> <span class=n>a</span> <span class=k>class</span> <span class=ow>or</span> <span class=n>interface</span><span class=o>.</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>CallStatic</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>Method</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>clazz</span><span class=p>,</span> <span class=n>jmethodID</span> <span class=n>methodID</span><span class=p>,</span> <span class=o>...</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>CallStatic</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>MethodA</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>clazz</span><span class=p>,</span> <span class=n>jmethodID</span> <span class=n>methodID</span><span class=p>,</span> <span class=k>const</span> <span class=n>jvalue</span> <span class=o>*</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>NativeType</span> <span class=n>CallStatic</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span><span class=n>MethodV</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>clazz</span><span class=p>,</span> <span class=n>jmethodID</span> <span class=n>methodID</span><span class=p>,</span> <span class=n>va_list</span> <span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>Invoke</span> <span class=n>an</span> <span class=n>instance</span> <span class=n>method</span> <span class=n>of</span> <span class=n>the</span> <span class=n>object</span><span class=o>.</span>
</span></span><span class=line><span class=cl>   <span class=o>//</span> <span class=n>The</span> <span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;</span> <span class=n>includes</span> <span class=n>each</span> <span class=n>of</span> <span class=n>the</span> <span class=n>eight</span> <span class=n>primitive</span> <span class=ow>and</span> <span class=ne>Object</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h3><p>[1] <a href=https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaNativeInterface.html>Java Programming Tutorial Java Native Interface (JNI)</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://lyapple2008.github.io/tags/android/>Android</a></li><li><a href=https://lyapple2008.github.io/tags/jni/>JNI</a></li></ul><nav class=paginav><a class=prev href=https://lyapple2008.github.io/posts/2019-03-10-%E9%9F%B3%E9%A2%91%E5%BC%80%E5%8F%91%E8%B5%84%E6%BA%90/><span class=title>« 上一页</span><br><span>音频开发资源</span>
</a><a class=next href=https://lyapple2008.github.io/posts/2019-01-26-2019%E5%B0%8F%E7%9B%AE%E6%A0%87/><span class=title>下一页 »</span><br><span>2019小目标--重新开始打脸之路</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on x" href="https://x.com/intent/tweet/?text=JavaNativeInterface%e7%ac%94%e8%ae%b0&amp;url=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f&amp;hashtags=Android%2cJNI"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f&amp;title=JavaNativeInterface%e7%ac%94%e8%ae%b0&amp;summary=JavaNativeInterface%e7%ac%94%e8%ae%b0&amp;source=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f&title=JavaNativeInterface%e7%ac%94%e8%ae%b0"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on whatsapp" href="https://api.whatsapp.com/send?text=JavaNativeInterface%e7%ac%94%e8%ae%b0%20-%20https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on telegram" href="https://telegram.me/share/url?text=JavaNativeInterface%e7%ac%94%e8%ae%b0&amp;url=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share JavaNativeInterface笔记 on ycombinator" href="https://news.ycombinator.com/submitlink?t=JavaNativeInterface%e7%ac%94%e8%ae%b0&u=https%3a%2f%2flyapple2008.github.io%2fposts%2f2019-03-03-javanativeinterface%25E7%25AC%2594%25E8%25AE%25B0%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><section><h2>Comments</h2><div id=comments-utteranc></div></section><script type=text/javascript>function getCurrentTheme(){return document.documentElement.getAttribute("data-theme")||document.body.classList.contains("dark")?"dark":"light"}function loadUtterances(e=!1){const t=document.getElementById("comments-utteranc");if(t!==null){t.innerHTML="";const n=document.createElement("script");n.setAttribute("id","utteranc"),n.setAttribute("src","https://utteranc.es/client.js"),n.setAttribute("data-repo","lyapple2008/comment"),n.setAttribute("data-category","Announcements"),n.setAttribute("data-mapping","pathname"),n.setAttribute("data-reactions-enabled","1"),n.setAttribute("data-emit-metadata","0"),n.setAttribute("data-theme",e?"github-dark":"github-light"),n.setAttribute("data-issue-term","title"),n.setAttribute("crossorigin","anonymous"),n.setAttribute("async","true"),t.appendChild(n)}}const isDarkMode=getCurrentTheme()==="dark";loadUtterances(isDarkMode);const themeObserver=new MutationObserver(e=>{e.forEach(e=>{if(e.type==="attributes"&&e.attributeName==="class"){const e=getCurrentTheme()==="dark";loadUtterances(e),console.log(`changing theme`)}})});themeObserver.observe(document.body,{attributes:!0,attributeFilter:["class"]})</script></article></main><footer class=footer><span>See this site&rsquo;s source code <a href=https://github.com/lyapple2008/lyapple2008.github.io>here</a>, licensed under GPLv3 ·</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>